æŒ‰ç…§ä»¥ä¸‹æç¤ºè¯ç”Ÿæˆæ•´ä¸ªé¡¹ç›®ï¼Œç»†èŠ‚éƒ¨åˆ†éœ€è¦å‚è€ƒ Software requirement.md

You are an expert .NET architect and C# engineer.

## ğŸŒŸ ç›®æ ‡
ç”Ÿæˆä¸€ä¸ª **.NET 8 WinForms è§£å†³æ–¹æ¡ˆ**ï¼Œå®ç°â€œæ¡Œé¢æ•´ç†åŠ©æ‰‹ Desktop Organizerâ€ï¼š
1. æ‰«æ Windows æ¡Œé¢æ–‡ä»¶ç»“æ„ã€‚
2. è¯»å–â€œç”¨æˆ·åå¥½â€ JSON å¹¶è¿åŒæ¡Œé¢ dump é€šè¿‡ HTTP POST è°ƒç”¨ LLMï¼ˆé»˜è®¤ DeepSeek Chatï¼ŒOpenAI å…¼å®¹ï¼‰ã€‚
3. æ”¶åˆ° LLM è¿”å›çš„ JSON åˆ†ç±»æ–¹æ¡ˆåï¼Œæä¾›å¯è§†åŒ–é¢„è§ˆï¼ˆTreeViewï¼Œå¯æ‹–æ‹½è°ƒæ•´ï¼‰ã€‚
4. æ ¹æ®ç”¨æˆ·ç¡®è®¤åˆ›å»ºæ–‡ä»¶å¤¹å¹¶ç§»åŠ¨æ–‡ä»¶ï¼Œæ”¯æŒè¿›åº¦æ¡ã€å–æ¶ˆã€ä¸€æ¬¡æ€§æ’¤é”€ã€‚
5. æ”¯æŒå¤šæ¨¡å‹ Provider Profileï¼ˆDeepSeek/OpenAI/Anthropic ç­‰ï¼‰ï¼ŒAPI Key åŠ å¯†ä¿å­˜åœ¨ Windows Credential Managerã€‚
6. UI ä¸ä¸šåŠ¡é€»è¾‘åˆ†å±‚ï¼šUI ä»…å¤„ç†æ˜¾ç¤ºä¸äº‹ä»¶ï¼Œå…¨éƒ¨ä¸šåŠ¡æ”¾åœ¨ App / Domain / Infrastructureã€‚
7. éµå¾ªå•ä¸€èŒè´£ï¼›æ¯ä¸ª *.cs* æ–‡ä»¶ â‰¤ 300 è¡Œï¼›æ–¹æ³• â‰¤ 40 è¡Œï¼›å…¨éƒ¨å¼‚æ­¥ (async/await)ã€‚

## ğŸ“‚ å¿…è¦é¡¹ç›®ç»“æ„
```

DesktopOrganizer.sln
â”‚
â”œâ”€ DesktopOrganizer.UI             (WinForms)
â”‚   â”œâ”€ MainForm.cs / MainForm.Designer.cs   // ä¸»çª—å£ï¼Œåˆ†éƒ¨ç±»
â”‚   â”œâ”€ PreferencesPane.cs                  // åå¥½ç¼–è¾‘
â”‚   â”œâ”€ ModelProfileDialog.cs               // Provider Profile CRUD
â”‚   â””â”€ UI.Resources.resx                   // ä¸­è‹±åŒè¯­
â”‚
â”œâ”€ DesktopOrganizer.App            (Application layer)
â”‚   â”œâ”€ Services/
â”‚   â”‚   â”œâ”€ DesktopScanService.cs
â”‚   â”‚   â”œâ”€ PlanPreviewService.cs
â”‚   â”‚   â”œâ”€ ExecutionService.cs
â”‚   â”‚   â””â”€ UndoService.cs
â”‚   â””â”€ DTO/
â”‚
â”œâ”€ DesktopOrganizer.Domain         (Entities / ValueObjects / Interfaces)
â”‚   â”œâ”€ Item.cs
â”‚   â”œâ”€ Plan.cs
â”‚   â”œâ”€ FolderRule.cs
â”‚   â””â”€ Interfaces.cs
â”‚
â””â”€ DesktopOrganizer.Infrastructure (æŠ€æœ¯å®ç°)
â”œâ”€ FileSystemScanner.cs
â”œâ”€ ExecutionEngine.cs
â”œâ”€ LLM/
â”‚   â”œâ”€ ILLMClient.cs
â”‚   â”œâ”€ DeepSeekClient.cs
â”‚   â”œâ”€ OpenAIClient.cs
â”‚   â””â”€ AnthropicClient.cs
â””â”€ Repositories/
â”œâ”€ PreferencesRepository.cs
â””â”€ ModelProfileRepository.cs

````

## ğŸ”‘ å…³é”®å®ç°è¦ç‚¹
- **Program.cs**ï¼šä½¿ç”¨ `HostBuilder` æ³¨å…¥ä¾èµ–ï¼Œ`ApplicationConfiguration.Initialize()` åè§£æ MainForm Presenterã€‚
- **ILLMClient**ï¼šç»Ÿä¸€ `ChatAsync()`ï¼›æ”¯æŒ `stream=true` å¹¶é€šè¿‡ `IProgress<string>` æŠŠå¢é‡ token å‘å› UI æ—¥å¿—é¢æ¿ã€‚
- **Credential å­˜å‚¨**ï¼š`CredentialManager` helperï¼Œç¤ºä¾‹ï¼š  
  ```csharp
  using CredentialManagement;
  new Credential { Target = profile.KeyRef, Password = apiKey, Type = CredentialType.Generic }.Save();
````

* **æ‰«æ**ï¼š`Directory.EnumerateFileSystemEntries(root, "*", SearchOption.TopDirectoryOnly)`ï¼Œå–æ–‡ä»¶ä¸ä¸€çº§æ–‡ä»¶å¤¹ã€‚
* **æ’¤é”€**ï¼š`UndoService` è®°å½• `List<(string src,string dst)>`ï¼Œå­˜è‡³ `%TEMP%\DesktopOrganizer_Undo.json`ã€‚
* **åå¥½ & æ¨¡å‹é…ç½®æ–‡ä»¶**ï¼š

  * `%APPDATA%\DesktopOrganizer\preferences.json`
  * `%APPDATA%\DesktopOrganizer\models.json`
* **LLM æç¤ºè¯**ï¼šä½¿ç”¨ä¸‹åˆ—æ¨¡æ¿ï¼ˆå ä½ç¬¦è¿è¡Œæ—¶æ›¿æ¢ï¼‰ï¼š

  ```text
  System: You are an expert desktop organization assistant.
  User:  Below is my preferences and desktop dumpâ€¦
  { {user_preferences} }
  { {json_desktop} }
  Return only JSON with schema â€¦
  ```

